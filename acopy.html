<!DOCTYPE html>
<html>
    <head>
        <title>IV: Project</title>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="DC.title" content="Dataset: gis/zone30 map | The Datatank"/>
        <base target="_parent" />

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script type="text/javascript" src='http://datasets.antwerpen.be/v4/public/js/leaflet.min.js'></script>
        <link rel="stylesheet" href="http://datasets.antwerpen.be/v4/public/css/leaflet.css?v=1.0" />
        <link type="text/css" rel="stylesheet" href="noUiSlider.11.1.0/nouislider.min.css"/>
        <style>
            body { margin:0; padding:0; font-family: sans-serif}
            #map { position:absolute; top:0; bottom:0; width:100%; }
            .fiets-route {
                opacity: 0.0;
                stroke: red;
                cursor: pointer;
            }
            #controls {
                display: grid;
                grid-template-areas: 
                    "left head head right rightbar"
                    "left center center right rightbar"
                    "left footer footer right rightbar";
                grid-template-columns: 1fr 5fr 3fr 2fr 75px;
                position: absolute;
                top:0px;
                bottom: 0px;
                left: 0px;
                right: 0px;
                z-index: 200;
                pointer-events:none;
            }

            .invisible {
                display: none;
            }

            #controls > div {
                pointer-events: all;
            }

            #rightbar {
                grid-area: rightbar;
                background: white;
                z-index: 100;
                box-shadow: 1px 1px 5px black;
            }

            #rightbar > .bar-item {
                font-size: 10pt;
                text-align: center;
                border: 2px solid black;
                height: 75px;
            }

            #control-panels {
                grid-area: right;
                overflow-y: auto;
                padding-left: 10px;
            }

            .control-panel {
                background: white;
                border-radius: 5;
                box-shadow: 1px 1px 5px black;
                padding: 10px;
            }

            #heatmap-controls{
            }

            .imf-preview {
                pointer-events: none;
            }

            #time-controls {
            }

            #nouislider-wrapper {
                min-height: 50px;
                margin-top: 40px;
            }
        </style>
    </head>
    <body>
        <div id='map'></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.js" integrity="sha256-j2LsvgOlQFIb2Mphb+tX7d5pNmFdpsJU+s5GNo3z63g=" crossorigin="anonymous"></script>
    <script src="/noUiSlider.11.1.0/nouislider.min.js"></script>
    <script src="/js/timeSlider.js"></script>
    <script src="/js/utility.js"></script>
    <script src="/js/var.js"></script>
    <script src="/js/heatmap/leafheat.js"></script>
    <script src="/js/story/story.js"></script>
    <script src="/js/filters.js"></script>
    <script src="/js/mapsetup.js"></script>
    <script src="/js/datareading.js"></script>
    <script src="/js/interactiveMapFilter.js"></script>
    <script src="/js/interactiveTimeFilter.js"></script>
    <script>
        function afterData() {
            // initialize map filter
            imf = new InteractiveMapFilter();

            // initialize time filter
            window.addEventListener('load', () => {
                window.itf = new InteractiveTimeFilter(imf.baseFilter);
                itf.setFilter(Filter.filterStartsInPeriod);
            })
        }
    </script>

        <script>
            function show(element){
                var target = document.getElementById(element.dataset.target);
                target.classList.toggle("invisible");
                // var others = document.getElementsByClassName("control-panel");
                // for (var i = 0; i < others.length; i++){
                //     if (others[i] != target){
                //         others[i].classList.add("invisible");
                //     }
                // }
            }

            function toggleHeatmap(e){
                if(!e.checked){
                    heatMap.setOptions({show: false});
                } else {
                    heatMap.setOptions({show: true});
                }
            }
            function optionsChange(slider, option){
                let newoption = {};
                newoption[option] = slider.value;
                slider.parentElement.getElementsByClassName("currentvalue")[0].innerHTML = slider.value;
                heatMap.setOptions(newoption);
            }

            function clearRadioButtons() {
                var radiobuttons = document.getElementsByClassName("imf-button");
                for (var i = 0; i < radiobuttons.length; i++){
                    radiobuttons[i].checked = false;
                }
            }

        </script>
        <div id="controls">
            <div id="control-panels">
                <div class="control-panel" id="time-controls">
                    <h2>Time Controls</h2>
                    <div id="nouislider-wrapper">
                        <div id="time-slider" style="position: relative; margin-left: 10%; width: 80%;"></div>
                    </div>
                </div>
                <div class="control-panel" id="heatmap-controls">
                    <h2>Heatmap Controls</h2>
                    <div>
                        <input type="checkbox" checked onchange="toggleHeatmap(this)"> Heatmap on
                    </div>
                    <div>
                        <h3>Line Width</h3>
                        1 <input type="range" min="1" max="30" value="3" onchange="optionsChange(this, 'lineWidth')"> 30 <span class="currentvalue"></span> 
                    </div>
                    <div>
                        <h3>Blur Radius</h3>
                        0 <input type="range" min="0" max="30" value="0" onchange="optionsChange(this, 'blurSize')"> 30 <span class="currentvalue"></span> 
                    </div>
                    <div>
                        <h3>Global Alpha</h3>
                        0 <input type="range" min="0" max="1" value="0.03" step="0.005" onchange="optionsChange(this, 'globalAlpha')" > 1 <span class="currentvalue"></span> 
                    </div>
                    <div>
                        <button onclick="heatMap.resetDefaultOptions()">Reset default</button>
                    </div>
                </div>
                <div class="control-panel" id="interactive-map-controls">
                    <input type="radio" class="imf-button" onclick="imf.removePreviewRectangle();imf.setFilter(Filter.filterStartWithin);imf.setWhenDone(clearRadioButtons);imf.enable();"> <label>StartWithin</label>
                    <input type="radio" class="imf-button" onclick="imf.removePreviewRectangle();imf.setFilter(Filter.filterStopsWithin);imf.setWhenDone(clearRadioButtons);imf.enable();"> <label>StopWithin</label>

                    <button onclick="imf.removeMapFilter()">Clear</button>
                </div>
            </div>

            <div id="rightbar">
                <div class="bar-item" data-target="time-controls" onclick="show(this)">
                    Time-controls
                </div>
                <div class="bar-item" data-target="heatmap-controls" onclick="show(this)">
                    Heatmap
                </div>
            </div>

            

        </div>
    </body>
</html>